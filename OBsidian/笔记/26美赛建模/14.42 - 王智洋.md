# 2 模型准备

## Assumptions and Explanations

**假设 1：电池内部温度分布均匀，视为集中热容系统。**

**解释 (Explanation)：**

尽管电池在大倍率放电时存在内部温度梯度，但鉴于智能手机电池尺寸较小（厚度通常小于 5 mm），且内部极片与集流体具备较高的热传导率，其毕渥数（Biot number）远小于 0.1。因此，忽略电池内部的空间温差，认为其表面温度等于中心温度，并仅考虑电池与环境间的对流换热是合理的。这为第 3.4 节采用常微分方程（ODE）替代偏微分方程（PDE）构建热模型提供了理论依据。

**假设 2：放电周期内的库伦效率为 100%，且忽略自放电效应。**

**解释 (Explanation)：**

本文主要研究智能手机在数小时内的放电行为（即 TTE 预测）。锂离子电池的自放电通常以月为单位，且在正常工作温度下，其放电库伦效率极高（>99%）。因此，在第 3.1 节 SOC 估算模型中，忽略由漏电流和副反应引起的电荷损失，不会对短时间尺度的预测精度产生显著影响。

**假设 3：模型参数呈准静态变化，且观测噪声服从高斯分布。**

**解释 (Explanation)：**

虽然电池内阻和极化电容随 SOC 及温度变化，但相对于毫秒级的电流采样频率，这些参数的变化速率极慢（通常为分钟级）。这一特性满足了第 3.3 节采用带遗忘因子递推最小二乘法（FFRLS）的前提条件。此外，假设电压和电流传感器的测量误差为独立同分布（i.i.d.）的零均值高斯白噪声，从而确保最小二乘估计具有无偏性和最优性。

**假设 4：各硬件模块的功耗相互独立，总功耗遵循线性叠加原理。**

**解释 (Explanation)：**

尽管在微观物理层面，CPU 发热可能轻微影响屏幕驱动电路的效率，但在工程计算中，这种二阶耦合效应通常可忽略不计。在第 4 章中，我们将屏幕、CPU 和射频模块的功耗分别建模并求和以作为电池负载，即假设各子系统间不存在非线性的能量交叉耦合，总功耗近似等于各主要耗能部件功耗之和。

**假设 5：电池老化主要由 SEI 膜增厚引起，且仅表现为容量衰减。**

**解释 (Explanation)：**

锂电池的老化机制十分复杂（包含析锂、活性材料损失等）。但在第 6 章的寿命预测中，为便于建立解析数学模型，本文采纳主流文献观点，视固体电解质界面膜（SEI）的生长为导致容量不可逆衰减的主导因素。同时，假设内阻增加与容量衰减之间存在固定的映射关系，因此不再单独对内阻老化进行建模。

**假设 6：电池的 OCV-SOC 映射关系在有效工作区间内具有函数平滑性与一致性。**

**解释 (Explanation)：**

虽然不同体系（如三元锂与磷酸铁锂）的电压平台各异，但在同一批次或同一型号（如 iPhone 15 Pro 采用的钴酸锂/三元体系）中，其热力学平衡电位 $V_{oc}$ 与 $z$ (SOC) 之间存在稳定的非线性映射。这使得我们可以利用 Shepherd 模型或多项式进行全局拟合，并忽略由迟滞效应（Hysteresis）引起的微小电压偏差。



## Notations

| **Symbol**                   | **Description**                          | **Unit**             |
| ---------------------------- | ---------------------------------------- | -------------------- |
| **Battery States & Circuit** |                                          |                      |
| $SOC(t)$                     | 电池当前的荷电状态 (State of Charge)     | $[0, 1]$ or $\%$     |
| $V_{term}(t)$                | 电池端电压 (Terminal Voltage)            | $V$                  |
| $V_{OCV}$                    | 开路电压 (Open Circuit Voltage)          | $V$                  |
| $I(t)$                       | 负载电流 (Load Current, 放电为正)        | $A$                  |
| $Q_{nom}$                    | 电池额定容量 (Nominal Capacity)          | $As$ or $mAh$        |
| $Q_{rem}(t)$                 | 剩余电荷量 (Remaining Charge)            | $As$                 |
| $R_0$                        | 欧姆内阻 (Ohmic Internal Resistance)     | $\Omega$             |
| $R_1, C_1$                   | 慢动态/扩散支路的电阻与电容              | $\Omega, F$          |
| $R_2, C_2$                   | 快动态/电荷转移支路的电阻与电容          | $\Omega, F$          |
| $V_1(t), V_2(t)$             | RC 支路上的极化电压                      | $V$                  |
| $E_0$                        | Shepherd 模型中的电池基准电动势          | $V$                  |
| $K$                          | Shepherd 模型中的极化系数                | $V$ or $\Omega$      |
| $A$                          | Shepherd 模型中指数区电压幅度            | $V$                  |
| $B$                          | Shepherd 模型中指数区时间常数系数        | -                    |
| **Thermodynamics**           |                                          |                      |
| $T(t)$                       | 电池实时温度                             | $K$ or $^{\circ}C$   |
| $T_{env}$                    | 环境温度 (Ambient Temperature)           | $K$ or $^{\circ}C$   |
| $T_{ref}$                    | 参考温度 (通常为 298.15 K)                | $K$                  |
| $m$                          | 电池质量 (注意与差分步长区分)            | $kg$                 |
| $C_p$                        | 电池比热容 (Specific Heat Capacity)      | $J/(kg\cdot K)$      |
| $h$                          | 对流换热系数                             | $W/(m^2\cdot K)$     |
| $A$                          | 电池散热表面积                           | $m^2$                |
| $\Phi_{gen}$                 | 电池内部产热功率                         | $W$                  |
| $Q_{ext}$                    | 外部元件传导至电池的热量                 | $W$                  |
| $E_a$                        | 活化能 (Activation Energy)               | $J/mol$ or $kJ/mol$  |
| $\alpha$                     | Arrhenius 温度修正因子                   | -                    |
| $\beta$                      | 温度敏感系数 (简化模型)                  | $1/K$                |
| **Algorithm (FFRLS)**        |                                          |                      |
| $\lambda$                    | 遗忘因子 (Forgetting Factor)             | -                    |
| $T_s$                        | 采样时间间隔                             | $s$                  |
| $m$                          | 差分步长 (m-step difference)             | -                    |
| $\Delta_m U(k)$              | m 步差分电压观测值                       | $V$                  |
| $\boldsymbol{\theta}$        | 待辨识参数向量                           | -                    |
| $\boldsymbol{\phi}$          | 数据回归向量                             | -                    |
| $\mathbf{K}(k)$              | 增益矩阵 (Gain Matrix)                   | -                    |
| $\mathbf{P}(k)$              | 协方差矩阵 (Covariance Matrix)           | -                    |
| $\sigma^2$                   | 噪声方差                                 | -                    |
| **Power Consumption Models** |                                          |                      |
| $P_{disp}$                   | 屏幕显示总功耗                           | $W$ or $mW$          |
| $P_{driver}$                 | 屏幕驱动电路静态功耗                     | $W$ or $mW$          |
| $A_{area}$                   | 屏幕物理显示面积                         | $in^2$               |
| $B(t)$                       | 归一化亮度设定 (Normalized Brightness)   | $[0, 1]$             |
| $\eta(t)$                    | 像素平均点亮率 (Average Pixel Luminance) | $[0, 1]$             |
| $\sigma$                     | 屏幕发光效率系数 (Luminous Efficiency)   | $mW/(in^2\cdot nit)$ |
| $P_{cpu}$                    | 处理器总功耗                             | $W$ or $mW$          |
| $P_{idle}$                   | 处理器/SoC 静态漏电功耗                  | $W$ or $mW$          |
| $f(t)$                       | 处理器实时主频                           | $GHz$                |
| $u(t)$                       | CPU 负载率/利用率                        | $[0, 1]$             |
| $\kappa_{cpu}$               | CPU 动态能效系数                         | $mW/GHz$             |
| $P_{net}$                    | 网络射频模组功耗                         | $W$ or $mW$          |
| $S(t)$                       | 接收信号强度 (Signal Strength)           | $dBm$                |
| $D(t)$                       | 数据传输状态 (Throughput Factor)         | $0$ or $1$           |
| $\lambda_{tech}$             | 网络制式系数 (如 4 G/5 G)                  | -                    |
| **Prediction & Aging**       |                                          |                      |
| $T_{empty}$                  | 剩余放电时间 (Time to Empty, TTE)        | $s$ or $min$         |
| $V_{cutoff}$                 | 关机截止电压                             | $V$                  |
| $SOH$                        | 电池健康状态 (State of Health)           | $\%$                 |
| $N(t)$                       | 累积等效循环次数                         | $Cycles$             |
| $\alpha_{ref}$               | 基准老化衰减率                           | $Cycle^{-1}$         |
| $z$                          | 老化模型中的时间/循环幂指数              | -                    |

# 3 电池模型

## 3.1 电池荷电状态模型

荷电状态是描述电池剩余电量与额定容量比例的关键物理量。其数学定义如下：

$$SOC(t) = \frac{Q_{\text{rem}}(t)}{Q_{\text{nom}}}$$

$$\frac{d(SOC(t))}{dt} = -\frac{I(t)}{Q_{\text{nom}}}$$

其中，$Q_{\text{rem}}(t)$ 为 $t$ 时刻电池的剩余电荷量，$Q_{\text{nom}}$ 为额定容量。

该方程构成了本文后续全耦合模型的核心状态基准。它不仅描述了电量的宏观线性衰减，还作为自变量实时决定了开路电压 $V_{\text{OCV}}$ 与内部阻抗 $R_i, C_i$ 的时变特性，从而实现了从电量消耗到电压动态响应的物理关联。 

## 3.2 二阶 Thevenin 等效电路模型（2 RC-ECM）

### 3 2.1 2 RC-ECM 模型建立

本文引入二阶 Thevenin 等效电路模型（2 RC-ECM）。该模型在欧姆内阻 $R_0$ 的基础上，串联了两组 RC 环节，分别用于捕捉不同时间尺度的电荷传递与物质扩散过程，电路如下：

**图 1 突然有负载后的电压突变展示，图 2 电路图展示**

![image.png](https://gitee.com/Slexy/picture/raw/master/20260202140848026.png)

![](https://gitee.com/Slexy/picture/raw/master/20260202140500053.png)

该模型的包含两个关键的极化环节：第一阶 RC 回路具有较小的时间常数 $\tau_1$，用于捕捉电极表面的电荷转移过程及双电层效应；而第二阶 RC 回路则拥有较大的时间常数 $\tau_2$，旨在表征锂离子在活性材料颗粒内部的固相扩散过程。

由此，端电压 $V_{\text{term}}$ 的表达式为：

$$V_{\text{term}}(t) = V_{\text{OCV}}(SOC) - V_1(t) - V_2(t) - I(t)R_0$$

其中，$V_1$ 和 $V_2$ 分别为两个 RC 支路的极化电压，其动力学状态方程由下式给出：

$$\begin{cases} \frac{dV_1}{dt} = -\frac{V_1}{R_1C_1} + \frac{I(t)}{C_1} \\ \frac{dV_2}{dt} = -\frac{V_2}{R_2C_2} + \frac{I(t)}{C_2} \end{cases}$$

### 3.2.2 （OCV-SOC）的表示



！！！！！！！！

开路电压 $V_{\text{OCV}}$ 可被视为电池的固有属性函数。针对这一非线性关系的数学表征，为克服高阶多项式在 $SOC$ 边界区域产生的数值振荡，本文采用**（引用）**夏尔巴模型来构建开路电压 $V_{\text{OCV}}$ 的非线性映射关系。

$$V_{\text{OCV}}(SOC) = E_0 - \frac{K}{SOC + \epsilon} + A \exp[-B(1 - SOC)]$$

上述公式中，$E_0$ 为基准电压，由正负极材料电势差决定；$K/(SOC + \epsilon)$ 项描述放电末期的电压崩塌趋势，其中 $\epsilon = 10^{-6}$ 用于规避数值奇点；指数项 $A \exp[-B(1-SOC)]$ 则用于模拟满电状态下的电压特性。

## 3.3 参数辨识：抗噪离散化与自适应追踪

### 3.3.1 $m$ 步差分算子与信噪比优化

在模型离散化过程中，传统的基于一阶欧拉法（Euler method）的单步差分近似极易受到高频测量噪声的影响。

当采样间隔 $T_s \to 0$ 时，信噪比急剧下降，导致最小二乘法回归矩阵出现病态特征。为解决此问题，本文引入 $m$ 步差分技术，通过引入时间跨度参数 m，构建广义差分算子：

$$\Delta_m U(k) = U(k) - U(k - m)$$

该方法理论上可将信噪比提升 $m^2$ 倍（功率级），考虑到电池动态响应的时间尺度，我们还设计了自适应窗口策略，确保差分窗口覆盖约 20 秒的动态区间。该策略在保留系统低频特征的同时，有效抑制了高频量化噪声。

### 3.3.2 带遗忘因子的递推最小二乘法（FFRLS）

基于 $m$ 步差分预处理，二阶 RC 电路模型可重构为如下离散化的自回归（ARX）结构：

$$\Delta_m U(k) = \boldsymbol{\phi}^T(k)\boldsymbol{\theta}(k) + e(k)$$

其中，$\Delta_m U(k)$ 为差分端电压观测值，待辨识参数向量 $\boldsymbol{\theta}$ 与数据回归向量 $\boldsymbol{\phi}$ 定义如下：

$$\boldsymbol{\theta}(k) = [a_1, a_2, b_0, b_1, b_2]^T$$

$$\boldsymbol{\phi}(k) = [-\Delta_m U(k-1), -\Delta_m U(k-2), \Delta_m I(k), \Delta_m I(k-1), \Delta_m I(k-2)]^T$$

由于电池参数并非恒定。因此，若采用递推最小二乘（RLS），会使主要的影响因素难以凸显，还会使数据的偏离程度越来越大。为实现参数的在线跟踪并适应电池的时变特性，我们引入带遗忘因子的递推最小二乘法（FFRLS）进行求解。

由于大量实际的数据集的采样间隔都大于 0.5 秒，因此本文的 ${\lambda}$ 取 0.98 。(1-\lambda) = 50$ 个采样点，以在参数跟踪速度与抗噪稳定性之间取得最优平衡。

### 3.3.3 物理参数提取与权重分配

FFRLS 输出的数学系数可能因噪声干扰而偏离物理意义，例如出现复数根或负时间常数的情况。为此，本文构建了包含物理可行域约束的解析逆映射流程。

Step 1 : 特征根求解与极点分离 2 RC 模型的动力学特征由分母特征方程 $z^2 + \hat{a}_1 z + \hat{a}_2 = 0$ 决定。首先求解该方程的两个数学根 $z_{1,2}$。

Step 2 : 若受噪声影响导致解算异常，需引入修正。
若出现复数根，此时取其模值作为实数极点的估计值：
$p_{1,2} = |z_{1,2}|$。
设定锂离子电池的物理时间尺度边界：慢动态（扩散）：$\tau_{slow} \in [100\text{s}, 1000\text{s}]$ 快动态（极化）：$\tau_{fast} \in [1\text{s}, 20\text{s}]$ 若计算出的 $\tau$ 落在此范围之外，则执行边界投影操作：$$\tau_i^* = \min(\max(\tau_i, \tau_{\min}), \tau_{\max})$$

Step 3: 欧姆内阻 $R_0$ 对应系统高频增益（$z \to \infty$），极化电阻 $R_{1,2}$ 则由部分分式展开求得：$$\begin{cases}
R_0 = \hat{b}_0 \\
R_1 = \frac{(\hat{b}_1 - \hat{b}_0 \hat{a}_1) + (\hat{b}_2 - \hat{b}_0 \hat{a}_2) (p_1^*)^{-1}}{(1 - p_1^*)(1 - p_2^* (p_1^*)^{-1})} \\
R_2 = \frac{(\hat{b}_1 - \hat{b}_0 \hat{a}_1) + (\hat{b}_2 - \hat{b}_0 \hat{a}_2) (p_2^*)^{-1}}{(1 - p_2^*)(1 - p_1^* (p_2^*)^{-1})}
\end{cases}$$ 进而由 $C_i = \tau_i^* / R_i$ 获得极化电容。

## 3.4 电池热动力学建模 (Battery Thermodynamics Modeling)

### 3.4.1  参数的温度敏感性修正 

电池内部的电荷传递过程遵循 Arrhenius 速率定律。为了在模型中量化这一非线性特性，我们将前文辨识得到的阻抗参数 $R_i$ ($i=0,1,2$) 修正为温度 $T(t)$ 的函数： 

$$R_i(SOC, T) = R_{i, ref}(SOC) \cdot \exp \left[ \frac{E_a}{R_g} \left( \frac{1}{T(t)} - \frac{1}{T_{ref}} \right) \right]$$

鉴于智能手机通常工作在 $0^\circ C \sim 45^\circ C$ 的有限温区内，为了降低在线计算的算力开销，本文将上述指数关系进行工程线性化处理：

$R_{real} =R_{ref} \cdot  exp[\beta \times(\frac{1}{T} - \frac{1}{T_{ref}})]$

其中 $\beta$ 为温度敏感因子，经验上常取$  2500 - 4500 K $。那么温度每升高 $1^\circ C$，内阻约下降 $4\% \sim 6\%$。

### 3.4.2 产热机理与热平衡方程 

电池内部的产热主要源于不可逆的焦耳热（Joule Heat） 

$$\Phi_{gen}(t) = I(t)^2 \left[ R_0(SOC, T) + R_1(SOC, T) + R_2(SOC, T) \right]$$

其中，$R_0, R_1, R_2$ 均为 $SOC$ 与 $T$ 的函数，反映了欧姆阻抗与极化阻抗随工况变化的产热特性。然而，智能手机电池并非孤立的热系统。其温度变化取决于自身产热、环境散热以及外部热源干扰的动态平衡。因此，我们建立如下集总参数热平衡方程： 

$$m_{bat} C_p \frac{dT(t)}{dt} = \Phi_{gen}(t) + \Phi_{cpl}(t) - \Phi_{diss}(t)$$

该方程左侧描述了由电池质量 $m_{bat}$ 和比热容 $C_p$ 决定的显热储存速率。右侧各项分别表征了热量的产生、流入与耗散。其中，散热项 $\Phi_{diss}(t)$ 遵循牛顿冷却定律，由综合对流换热系数 $h$ 及有效散热面积 $A_{surf}$ 决定，描述了电池向机身内部环境的热释放过程：$\Phi_{diss}(t) = h A_{surf} (T(t) - T_{env})$。 

其中 $A_{surf}$ 为有效散热面积。依据电子设备热设计经验，$h$ 可取 $5 \sim 15 W/(m^2 \cdot K)$ 的典型区间值。 

### 3.4.3  紧凑空间下的多源热耦合效应 

电池的热状态不仅取决于自身产热，还受到散热条件及邻近热源的影响。耦合热流项 $\Phi_{cpl}(t)$： 如下：

$$\Phi_{cpl}(t) = \sum_{x \in \{CPU, Screen, \dots\}} \gamma_{x} P_{x}(t)$$

式中，$P_x(t)$ 为各外部组件的瞬时功耗，而 $\gamma_{x}$ 被定义为无量纲的热耦合系数。该系数表征了外部组件功耗转化为电池温升的传导效率，以提升了模型在复杂工况下的预测保真度。 

### 3.5 多物理场耦合的系统模型

#### 3.5.1 离线参数图谱构建 (Offline Parameter Map Construction)

模型运行的先决条件是获取电池阻抗参数（$R_0, R_1, R_2, C_1, C_2$）与荷电状态 ($SOC$) 的非线性映射关系。鉴于这些参数在实际运行中无法直接测量，本研究采用“离线标定 + 在线查表”的策略：

1. **基准实验**：首先对电池进行一次完整的标准放电测试，涵盖 $100\% \to 0\%$ 的 $SOC$ 区间。
2. **参数提取**：利用 3.3 节提出的 **FFRLS 算法** 对实验数据进行逐点辨识，提取出每一时刻的最优阻抗参数。
3. **图谱拟合**：将辨识结果映射为关于 $SOC$ 的线性插值，记为 $\mathcal{F}(SOC) = \{R_i(SOC), C_i(SOC)\}_{i}$。
#### 3.5.2 功率驱动的状态空间方程

定义系统状态向量 $\mathbf{x}(t) = [SOC(t), V_1(t), V_2(t), T(t)]^T$，外部输入向量为 $\mathbf{u}(t) = [P(t), T_{env}(t)]^T$。则系统的全局动态演化过程可由以下非线性常微分方程组描述：

$$\begin{cases} \dot{SOC}(t) = -\frac{P(t)}{V_{\text{term}}(t) \cdot C_{bat}} \\ \dot{V}_1(t) = -\frac{V_1(t)}{\tau_1(SOC, T)} + \frac{P(t)}{V_{\text{term}}(t) \cdot C_1(SOC, T)} \\ \dot{V}_2(t) = -\frac{V_2(t)}{\tau_2(SOC, T)} + \frac{P(t)}{V_{\text{term}}(t) \cdot C_2(SOC, T)} \\ \dot{T}(t) = \frac{1}{m C_p} \left[ \frac{P(t)^2}{V_{\text{term}}(t)^2} R_{total}(SOC, T) + \Phi_{cpl}(t) - h A (T(t) - T_{env}) \right] \end{cases}$$

### 3.5.3 需求端代数耦合约束

电池的输出电流 $I(t)$ 并非独立变量，而是受限于瞬时功率平衡。根据功率定义 $P(t) = V_{\text{term}}(t) \cdot I(t)$，电流必须满足以下代数约束：

$$P_{\text{total}}(t) = \left[ V_{\text{OCV}}(SOC) - V_1(t) - V_2(t) - I(t)R_0(SOC, T) \right] \cdot I(t)$$

其中总需求功率 $P_{\text{total}}(t)$ 由第 4 章定义的各组件功耗之和决定 

## 3.6 数值求解流程（Numerical Solution of the Problem）

前述建立的多物理场耦合模型本质上是一个非线性微分-代数方程组。为了在数字计算环境中实现该模型的高效求解，本文设计了基于时间步长 $\Delta t$ 的离散化迭代算法。该算法通过解耦代数约束与微分状态更新，实现了从 $k$ 时刻到 $k+1$ 时刻的系统演化。 

- **Step 0（准备阶段）**： 在每一迭代步的起始阶段，首先根据当前状态 $SOC_k$ 和温度 $T_k$ 更新系统的时变参数。利用 3.5.1 节构建的离线图谱（Look-up Tables），获取基准温度下的电化学参数： 
  $$\begin{aligned} R_{i, ref} &= \mathcal{F}_{R_i}(SOC_k), \quad i \in \{0, 1, 2\} \\ C_{i, ref} &= \mathcal{F}_{C_i}(SOC_k), \quad i \in \{1, 2\} \\ V_{OCV, k} &= f_{OCV}(SOC_k) \end{aligned}$$

 随后，引入温度反馈机制对阻抗进行实时修正。 

$\alpha_k = exp[\beta \times(\frac{1}{T} - \frac{1}{T_{ref}})]$

$$R_{i, k} = R_{i, \text{ref}} \cdot \alpha_k$$

- **Step 1（电流求解）**： 由于负载功率 $P_k$ 与端电压、电流之间存在非线性隐式关系，需通过求解代数方程来消除代数环。定义当前的总极化压降为 $V_{\text{polar}, k} = V_{1, k} + V_{2, k}$。根据功率守恒原则，驱动电流 $I_k$ 必须满足如下二次方程的判别式约束： 

$$\Delta = (V_{ocv,k} - V_{polar,k})^2 - 4 \cdot R_{0,k} \cdot P_k$$

$$I_k = \frac{(V_{ocv,k} - V_{polar,k}) - \sqrt{\Delta}}{2 R_{0,k}}$$

​     若 $\Delta_k < 0$，系统判定为电池无法满足当前的瞬时功率需求，将发生执行功率截断或关机预警程序。 

- **Step 2（状态更新）**： 在获得准确的驱动电流 $I_k$ 后，利用欧拉法更新 $SOC$ 及极化电压状态量：

SOC:

$$SOC_{k+1} = SOC_k - \frac{I_k \cdot \Delta t}{Q_{nom}}$$

$V_1, V_2$:

针对不同时间尺度的极化响应，其状态演化遵循如下离散化动力学方程：

$$\begin{cases} V_{1, k+1} = V_{1, k} + \left( \frac{I_k}{C_{1, k}} - \frac{V_{1, k}}{R_{1, k} C_{1, k}} \right) \cdot \Delta t \\ V_{2, k+1} = V_{2, k} + \left( \frac{I_k}{C_{2, k}} - \frac{V_{2, k}}{R_{2, k} C_{2, k}} \right) \cdot \Delta t \end{cases}$$

#### Step 3 热动力学演化与温度更新 ：

最后，基于能量守恒定律更新系统的热状态。温度 $T_{k+1}$ 的演化不仅取决于由内阻引起的不可逆产热，还受到外部热耦合 $\Phi_{\text{cpl}, k}$ 与对流散热的影响：

$$T_{k+1} = T_k + \frac{\Delta t}{m_{\text{bat}} C_p} \left[ I_k^2 \cdot (R_{0, k} + R_{1, k} + R_{2, k}) + \Phi_{\text{cpl}, k} - h A_{\text{surf}} \cdot (T_k - T_{\text{env}}) \right]$$

上述迭代过程循环执行，直至 $SOC$ 或 $V_{\text{term}}$ 触发截止阈值。

在实际运用中，为进一步抑制欧拉法产生的累积截断误差，可以采用**四阶龙格-库塔法 (RK 4)** 进行状态推进，以保证长时步仿真下的数值稳定度与预测精度。

## 3.8  参数辨识与仿真验证

### 3.8.1 电化学参数辨识结果分析 

为全面验证二阶 Thevenin 等效电路模型（2 RC-ECM）及电-热耦合机制的有效性，本研究统一采用 **Oxford Battery Degradation Dataset ** 作为数据基准。

首先，利用带遗忘因子的递推最小二乘法 (FFRLS) 在 $0\% \sim 100\%$ 的全 $SOC$ 域内对电池阻抗参数进行了离散化辨识。

结果表明，电池的欧姆内阻 $R_0$ 在 $0.0200 \sim 0.0234 \, \Omega$ 区间内波动，且极化参数呈现显著的频域分离特性：快动态支路时间常数 $\tau_1 \approx 2.22 \, \text{s}$ 精确表征了电荷转移过程，而慢动态支路时间常数 $\tau_2 \approx 41.07 \, \text{s}$ 则有效反映了浓差极化的滞后效应。

基于 Arrhenius 修正模型，取经验值 $\beta = 3000 \, \text{K}$。基于上述辨识结果，本文设计了以下两个独立的仿真实验。 

### 3.8.2 热力学行为验证

为了评估电-热耦合机制的有效性，本文模拟了 **5 W 恒功率放电** 工况

（条件 $SOC=100\%, T=25^\circ\text{C}$。环境 25）。

图 x

仿真结果显示，电池在连续运行 31.33 分钟后触发截止电压。在此过程中，内部产热与散热逐渐达到准平衡态，最高温升控制在 $2.87 \, \text{K}$。能量效率分析表明，该系统在 5 W 负载下的放电效率为 $95.8\%$，证明了该 2 RC-ECM 模型在描述高功率放电时的产热功率具有极高的物理合理性。

### 3.8.3 模型精度评价与鲁棒性分析

图 x

在确认热模型合理性的基础上，为了排除热积分误差的干扰并专门评估电学模型的预测精度，本文进行了基于 **Oxford C 1 动态数据集** 的验证实验。与恒功率实验不同，该实验采用了“电学闭环、热学开环”的策略：即旁路掉热力学方程的积分过程，直接将数据集中的实测温度序列 $T_{real}(t)$ 作为已知的外生变量输入模型，从而将验证焦点锁定在电压响应与 SOC 估计的准确性上。 



**表 3：全耦合仿真模型误差统计**

| **评价指标 (Metric)** | **电流预测 (Current Estimation)** | **端电压预测 (Voltage Estimation)** |
| ----------------- | ----------------------------- | ------------------------------ |
| **均方根误差 (RMSE)**  | $10.35 \, \text{mA}$          | $45.53 \, \text{mV}$           |
| **相对误差 (RE)**     | $1.40\%$                      | $1.22\%$                       |
| **最大绝对误差 (MAE)**  | $28.10 \, \text{mA}$          | $89.20 \, \text{mV}$           |
|                   |                               |                                |



# 4. 需求端多物理场功耗建模

鉴于屏幕、SoC 及射频系统占据整机能耗的 **85%~90%**，本文基于组件物理特性构建设备负载模型，将整机总功率 $P_{\text{total}}$ 表述为：

$$P_{\text{total}}(t) = P_{\text{disp}}(t) + P_{\text{SoC}}(t) + P_{\text{RF}}(t) + P_{\text{other}}$$

## 4.1 零部件功耗模型

- 屏幕显示模型 

现代智能手机大多采用 oled 屏幕，针对 OLED 的自发光特性，我们将瞬时功率 $P_{disp}(t)$ 建模为静态驱动与动态发光的线性组合：

$$P_{disp}(t) = P_{driver} + \sigma \cdot A_{area} \cdot B(t) \cdot \eta(t)$$

式中，$P_{driver}$ 为触控与背板驱动的静态功耗；动态项由屏幕面积 $A_{area}$、发光效率系数 $\sigma$ 决定，并受归一化亮度 $B(t)$ 及表征像素点亮率的平均图像电平 (APL) $\eta(t)$ 实时调节。

- 处理器单元 (Processor Unit)

考虑到现代 SoC 的 DVFS 机制使电压与频率强耦合，本文将 CMOS 电路动态功耗规律简化为关于频率 $f(t)$ 与利用率 $u(t)$ 的线性模型：

$$P_{cpu}(t) = P_{idle} + \kappa_{cpu} \cdot f(t) \cdot u(t)$$

其中，$P_{idle}$ 为芯片静态漏电功耗；$\kappa_{cpu}$ 为聚合了制程电容特性及电压调节策略的能效系数。

- 射频信号系统 

受自适应发射功率控制机制主导，射频功耗呈非线性特征。为补偿路径损耗以维持信噪比，构建基于信号强度 $S(t)$ 的指数模型：

$$P_{net}(t) = P_{base} + \lambda_{tech} \cdot D(t) \cdot 10^{\frac{-S(t)}{K}}$$

式中，$P_{base}$ 为基带底噪；$\lambda_{tech}$ 为网络制式权重；$D(t)$ 为吞吐状态指示函数。指数项精确刻画了信号强度 $S(t)$ (dBm) 下降时，调制解调器为维持链路导致的功耗激增。

- 其他功耗 ($P_{\text{other}}$)

涵盖传感器、音频及总线接口等背景功耗，本研究将其简化为常数处理。

## 4.2 参数标定与模型验证

### 4.2.1 硬件参数标定

选取 iPhone 15 Pro 作为基准设备。基于硬件实测与技术规格，关键参数标定如表 1 所示：

| **模块**     | **参数符号**          | **标定值**                        | **物理说明**         |
| ------------ | --------------------- | --------------------------------- | -------------------- |
| **电池系统** | $Q_{\text{nom}}$      | $11786.4 \text{ As}$              | 额定容量 (3274 mAh)  |
|              | $R_0$                 | $0.085 \text{ } \Omega$           | 1 C 放电下典型内阻    |
| **屏幕显示** | $A_{\text{area}}$     | $14.1 \text{ in}^2$               | 6.1 英寸物理面积     |
|              | $P_{\text{driver}}$   | $180 \text{ mW}$                  | LTPO 驱动电路基耗    |
|              | $\sigma$              | $0.32 \text{ mW/in}^2/\text{nit}$ | M 12 材料发光效率系数 |
| **处理器**   | $P_{\text{idle}}$     | $120 \text{ mW}$                  | 静态漏电功耗         |
|              | $\kappa_{\text{cpu}}$ | $215 \text{ mW/GHz}$              | 3 nm 工艺能效系数     |
| **信号系统** | $P_{\text{base}}$     | $110 \text{ mW}$                  | X 70 基带待机底噪     |
|              | $\lambda_{\text{5G}}$ | $2.5$                             | 5 G 制式增益权重      |

### 4.2.2 模型验证

为验证模型精度，选取 **DXOMARK 续航测试**中的常规工况 ($L = 200 \text{ nits}, \eta=0.6, S = -75 \text{ dBm}$) 为基准。对比结果表 2 显示，模型计算值 $P_{\text{calc}}$ 与实测值 $P_{\text{ref}}$ 的相对误差均控制在 6% 以内，表明该模型兼具物理可解释性与高仿真保真度。

| **耗电组件**     | **测试工况**        | **模型值 (Pcalc)** | **实测值 (Pref)**      | **相对误差** |
| ---------------- | ------------------- | ------------------ | ---------------------- | ------------ |
| **屏幕 (OLED)**  | 200 nits, APL=60%   | $541.0 \text{ mW}$ | $525 - 550 \text{ mW}$ | $\sim 1.1\%$ |
| **处理器 (SoC)** | 静态待机+轻量背景   | $158.7 \text{ mW}$ | $150 - 175 \text{ mW}$ | $\sim 5.6\%$ |
| **信号系统**     | Wi-Fi, RSSI=-75 dBm | $150.0 \text{ mW}$ | $140 - 165 \text{ mW}$ | $\sim 3.4\%$ |



# 5. 剩余时间预测及场景验证

## 5.1 TTE 预测模型

从数据中发现，手机的关机并不是 SoC 到 0，而是几乎都是 SoC 未达到零就关机了

因此我们需要对模型进行一定的改动

我们发现手机关机的一个重要信号是 Vterm 突然低于一定值，因此我们定义定义如下：

$$T_{empty} = \min \{ t \mid SOC(t) \le 0 \text{ OR } V_{term}(t) \le V_{cutoff} \}$$

**$T_{SOC=0}$（容量耗尽时间）**

**$T_{V=V_{cutoff}}$（电压截止时间）**：**这是最常见但也最难算的情况**（尤其是低温或老化时）。

# 5. 剩余时间预测及场景验证

基于前文构建的组件级功耗模型（需求端）与电-热耦合电池模型（供给端），本章建立动态供需耦合仿真框架。针对实际使用中电量显示非零但设备突然关机的现象，本文提出一种双重约束下的 TTE (Time-to-Empty) 预测策略，并量化环境温度与负载随机性对续航性能的影响。

## 5.1 供需耦合 TTE 预测模型

实测数据显示，在低温或高老化状态下，端电压跌落往往先于化学容量耗尽发生。因此，我们将 TTE 定义为容量耗尽时间与电压截止时间的极小值：$$TTE = \min(t_{SOC=0}, \ t_{V_{term} \le V_{cutoff}})$$ 

我们利用 Runge-Kutta 方法对 3 节的微分方程组进行离散求解，计算 $V_{term}(t)$ 




### 5.1.3 预测算法的求解流程

为了清晰展示预测逻辑，本文采用的前向预测算法流程如下所示：

Step 1: 参数初始化。设定当前环境温度 $T_{env}$、初始电量 $SOC_0$ 以及待测场景的负载参数矩阵。
Step 2: 阻抗温度校正。根据当前电池温度 $T_k$，修正内阻 $R(T_k) = R_{ref} \cdot \exp[\beta(T_{ref}-T_k)]$。
Step 3: 联立求解电流。利用公式求解 $I_k$。此时需注意，若负载功率过大导致方程无解（判别式 $\Delta < 0$），则判定为电压瞬间崩塌导致关机。
Step 4: 热电状态更新。计算该步长产生的焦耳热 $Q_{gen} = I_k^2 R_{total}$，并结合对流散热公式更新 $T_{k+1}$。

Step 5: 边界判定。若满足 $V_{term,k} \le 3.3V$ 或 $SOC_k \le 0$，停止迭代并记录当前累积时长为 TTE；否则返回 Step 2。

## 5.2.1 仿真场景建模与参数设定

表 5-1 不同负载场景下的需求端模型参数设定

| 场景编号 | 场景描述             | 屏幕亮度 $B$ | CPU 负载 $u$ | 信号强度 $S$ (dBm) | 预估平均功耗 |
| :------- | :------------------- | :----------- | :----------- | :----------------- | :----------- |
| S 1      | 极高负载（3 D 游戏） | 0.7 (高)     | 0.85         | -105 (弱)          | $\sim 5.5W$  |
| S 2      | 中等负载（在线视频） | 0.5 (中)     | 0.20         | -75 (优)           | $\sim 1.6W$  |
| S 3      | 低负荷（电子书阅读） | 0.3 (低)     | 0.05         | - (离线)           | $\sim 0.6W$  |

表 5-2 几种具有代表性工况下预测 TTE 与关机诱因分析（iPhone 15 Pro 耦合模型仿真）

| 场景 | 环境温度 | 预测 TTE | 实测/参考对比 | 提前关机原因 |
| :--- | :------: | :------: | :-----------: | :----------- |
| S 1  |   25°C   |  3.0 h   |     3.2 h     | 端电压跌落   |
| S 1  |  -10°C   |  0.7 h   |     0.9 h     | 端电压跌落   |
| S 2  |   25°C   |  9.5 h   |     9.8 h     | 容量耗尽     |



### 5.2.2 不确定度分析与模型的评估

为了能够量化不同场景之间的预测模型与现实案例之间的差异，我们定义

$$RE_{i,j} = \frac{|TTE_{pred} - TTE_{ref}|}{TTE_{ref}} \times 100\%$$

 $RE_{i,j}$ 表示对应场景下的不确定度。

其中 $TTE_{pred}$ 为我们模型预测的 TTE ，
$TTE_{ref}$ 为实际测试中的 TTE。
计算几种具有代表性的对应可得：
量化分析显示，尽管模型在常温下表现优异 $RE(S1, 25^{\circ}C)$ 仅为 2.2% $RE(S2, 25^{\circ}C)$ 仅为 3.1%，证明了模型在标准环境下的高可靠性。然而，在高负载低温工况下，$RE(S1, -10^{\circ}C)$ 扩大至 22.2%出现了明显偏差。
这可以从我们的模型本身找到解释，
结合前文 Section 3 的电-热耦合理论与 Section 4 的负载特性，这种差异主要由以下机制驱动：

一般而言，常温处于 Arrhenius 曲线的平坦区，模型对参数摄动具有鲁棒性。而 -10°C 位于阻抗随温度变化的指数陡峭区，内阻修正系数 $\alpha$ 的微小拟合偏差会被非线性放大，导致 $V_{drop}$ 的估算误差显著增加。
且在 5.5 W 高功率使用时，电池内部实际会产生明显热量这种“自发热”会提升电池自身温度，使其不能被认为和环境温度相同，降低预测精度。

### 5.2.3 耗电驱动因素的分析

根据前文对各个组件功率的分析，我们得出在各个情境下各个主要组件的功率占总功率的比值，如下图：


##这里需要加入图片##

模型和数据表明，电池的续航短板是动态变化的：
在高负载使用时。处理器的功耗占比超过 50% 和显示屏占 40.1% 是，共同决定了电量的快速消耗。
如果此时环境寒冷，高功率会成倍地加剧电压跌落风险。

在中等负载使用时。处理器的功耗大幅下降，屏幕显示成为了最大的耗电，占比约 48.9%。此时的电量主要受亮度设置影响。

待机时。总功耗低，各个元件占比相近，电量消耗无主要决定因素。

从总体看，异常寒冷的环境、中高亮度的屏幕显示以及高负荷的 CPU 运转对电池消耗影响巨大。也可以看出中低等负载下处理器负载率 ($u$) 的对整体功耗的影响被显著稀释。

# 6. 灵敏性分析

## 6.1 热力学参数与散热条件的灵敏度

基于 Arrhenius 定律，温度升高能显著降低电化学内阻。为量化该热-电耦合效应，我们设定基准负载 $P_{load} = 1.8 \text{ W}$，对比**散热受限** ($h = 0.2 h_{ref}$)、**标准散热** ($h = 1.0 h_{ref}$) 及**强力散热** ($h = 3.0 h_{ref}$) 三种工况。

### 6.1 结果分析

对放电末端的分析展示了散热受限反致续航延长的现象：
**物理机制**：放电末期电流激增 ($I=P/V$) 引发剧烈焦耳产热。散热受限工况下的积热效应通过 Arrhenius 机制降低内阻，从而延缓端电压 ($V_{term}=V_{OCV}-IR$) 的跌落速率。
**量化结论**：散热受限组相比标准工况延迟约 **28 秒 (+28 s)** 关机。该结果验证了模型对电耦合动态的高保真捕捉能力。

## 6.3 负载随机扰动下的鲁棒性分析

### 6.3.1 随机过程建模 (Stochastic Modeling)

为量化真实调度机制下的负载随机性，引入高斯白噪声构建动态功率模型：

$$P_{real}(t) = P_{base} \cdot [1 + \delta(t)], \quad \delta(t) \sim \mathcal{N}(0, \sigma^2)$$

其中 $\sigma \in [0, 0.2]$。通过 1000 次蒙特卡洛模拟与核密度估计 (KDE)，重构 TTE 概率演化轨迹。

### 6.3.2 概率密度演化分析 (Probability Density Evolution Analysis)

图 6-3 展示了系统稳定性随波动增强的动力学特征：

- **确定性主导 ($\sigma \approx 0$)**：概率密度呈高发散峰度，TTE 收敛于 $8.38 \text{ h}$，显示模型在微扰下的高鲁棒性。
- **不确定性扩散 ($\sigma \to 0.25$)**：随 $\sigma$ 增大，概率峰显著坍塌与展宽（方差爆炸），系统可预测性下降。
- **非线性非对称风险**：分布呈现向低 TTE 方向的**左偏特征**。这表明正向功率尖峰触发电压截止的效应强于负向补偿，导致动态负载更倾向于诱发设备“提前关机”。

## 6.3 电池寿命周期老化模型

### 6.3.1 模型建立

针对电池长期运行中的性能退化现象，本文建立基于电池健康状态的模型。SOH 定义为当前最大可用容量 $C_{max}(t)$ 与标称容量 $C_{nom}$ 的比值：
$$SOH(t) = \frac{Q_{max}(t)}{Q_{nom}}$$
基于 SEI 膜生长理论与 Arrhenius，我们构建了包含温度效应与累积循环效应的耦合老化方程。模型的最终形式如下：

$$\frac{dSOH}{dt} = - \alpha_{ref} \cdot \underbrace{\exp \left( \frac{E_a}{R} \left( \frac{1}{T_{ref}} - \frac{1}{T(t)} \right) \right)}_{\text{Arrhenius temperature correction}} \cdot \underbrace{z \cdot N(t)^{z-1}}_{\text{Temporal power-law term}}$$
其中：

- $T(t)$ 为实时环境温度，通过 Arrhenius 定律描述热化学反应速率；
- $N(t)$ 为累积等效循环次数。

### 6.3.2 参数辨识与模型判定

  我们利用 **SNL 18650 NMC** 数据集对模型进行参数标定。NMC 体系与现代智能手机电池的电化学特性高度一致，确保了参数迁移的有效性。通过非线性回归辨识得到的物理参数见表：

| **符号**       | **物理含义**              | **标定值** | **单位**     |
| -------------- | ------------------------- | ---------- | ------------ |
| $E_a$          | 活化能 (对温度的敏感度)   | 34.17      | $kJ/mol$     |
| $z$            | 时间指数 (SEI 增长规律)   | 0.4942     | -            |
| $\alpha_{ref}$ | 基准衰减率 ($25^\circ C$) | 7.14 e-3   | $Cycle^{-1}$ |

### 6.3.3 结果分析

利用标定后的模型以及真实原始数据，我们进行了分析，结果如图所示。

**1. 温度与循环次数的耦合影响：**
可以看出，SOH 的衰减并非线性过程。在低温工况下，SOH 的下降较为平缓，电池表现出极佳的循环稳定性；然而，随着温度升高，曲面呈现明显的下降趋势。在 $35^\circ C$ 高温环境下，相同循环次数导致的容量损失约是 25 度下的 **1.86 倍**。
**2. 极端工况分析：**
当智能手机由于运行大型负载或环境散热不佳导致电池局部温度升至 $45^\circ C$ 时，单次循环对 SOH 造成的损伤具有显著的“加速效应”。仿真显示，长期处于高温环境将导致电池提前进入寿命末期，这有力地解释了热管理失效是导致电池续航能力意外缩减的主导因素。
 ![111. png](assets/20260202143634416.png)

# 8 建议与模型泛化

基于前文构建的电-热-老化多维耦合模型及仿真结论，本章从用户行为指导、操作系统优化策略以及模型泛化能力三个维度提出具体建议。

## 8.1 面向用户的行为建议

1. 在户外寒冷环境（$<0^{\circ}\text{C}$）下，应尽量避免运行 3 D 游戏或视频渲染等高功率应用避免电量快速消耗。

2. 老化模型表明，高温促进 SOH 衰减。$35^{\circ}\text{C}$ 下的寿命衰减速率是常温下的 1.86 倍。因此应当避免“边充边玩”。高负载放电热与充电化学热的叠加极易使电池温度突破 $40^{\circ}\text{C}$ 的老化加速阈值。

## 8.2 基于模型的系统级优化策略

1. 热感知充电控制 (Thermal-Aware Charging)：基于 Arrhenius 老化规律，系统应引入温度环路控制。当监测到电池温度超过 $35^{\circ}\text{C}$ 时，应主动降低充电电流，以微小的充电时间代价换取电池寿命的显著延长。

2. 内容自适应亮度调节：鉴于 OLED 屏幕在中等负载中功耗占比近半（~48%），OS 应结合内容像素亮度（APL），对高亮区域进行动态压暗处理，从源头降低基底功耗。

## 8.3 模型的泛化与扩展

1. 高倍率设备（无人机）：本文的 2 RC 模型能精确捕捉秒级极化效应，适用于预测无人机机动飞行时的电压骤降风险，防止空中断电。

2. 微型设备（智能手表）：针对容量极小的穿戴设备，本文的静态漏电流模型可用于优化超低功耗待机策略。